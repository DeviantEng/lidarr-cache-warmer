# /data/config.ini
# Configuration for lidarr-cache-warmer with dual-phase processing + text search

[lidarr]
# Set to your Lidarr instance URL and API key
base_url = http://192.168.1.103:8686
api_key = REPLACE_WITH_YOUR_LIDARR_API_KEY

# Disable TLS certification verification (i.e., self-signed certs)
verify_ssl = true

[probe]
# API endpoint to probe for cache warming
target_base_url = https://api.lidarr.audio/api/v0.4
timeout_seconds = 10

# Shared API settings (applies to all phases)
delay_between_attempts = 0.25
max_concurrent_requests = 10
rate_limit_per_second = 5

# Per-entity cache warming settings
max_attempts_per_artist = 25
max_attempts_per_artist_textsearch = 25
max_attempts_per_rg = 15

# Circuit breaker settings (stops run if API is completely broken)
circuit_breaker_threshold = 50
backoff_factor = 0.5
max_backoff_seconds = 15

[ledger]
# Storage backend: "csv" (default) or "sqlite"
# SQLite recommended for libraries with >2000 artists
storage_type = csv

# CSV file paths (used when storage_type = csv)
artists_csv_path = /data/mbid-artists.csv
release_groups_csv_path = /data/mbid-releasegroups.csv

# SQLite database path (used when storage_type = sqlite)
db_path = /data/mbid_cache.db

[run]
# Phase 0.2: Manual entry injection from YAML file
process_manual_entries = false

# Phase 1: Artist MBID cache warming (always enabled)
# Phase 2: Artist text search cache warming (warms search-by-name cache)
process_artist_textsearch = true

# Phase 3: Release group MBID cache warming
process_release_groups = false

# Force modes (re-check already successful entries)
# When true, sets max attempts to 1 for quick refresh
force_artists = false
force_text_search = false
force_rg = false

# Process in batches of 25 entities
batch_size = 25
# Save progress every 5 requests
batch_write_frequency = 5

# Text search preprocessing options
# Convert artist names to lowercase before text search (e.g., Metallica -> metallica)
artist_textsearch_lowercase = false
# Remove symbols and diacritics from artist names (e.g., CafÃ© Tacvba -> Cafe Tacvba)
artist_textsearch_remove_symbols = false

[manual]
# Manual entry injection settings (used when process_manual_entries = true)
# Path to YAML file containing manual artist/release group entries
manual_entries_file = /data/manual_entries.yml

[schedule]
# Scheduler settings (used by entrypoint.py for continuous operation)
# Run every N seconds (3600 = hourly)
interval_seconds = 3600

# Run immediately when container starts
run_at_start = true

# Optional: randomize pre-run delay each time, 0 to N seconds
jitter_seconds = 0

# Stop after a certain number of runs (25 = default)
max_runs = 25

[actions]
# Integration settings
# Tell Lidarr to refresh artist when cache transitions from timeout/unknown -> success
update_lidarr = false

[monitoring]
# Logging and progress settings
# Report progress every N requests
log_progress_every_n = 25
# Log level: DEBUG, INFO, WARNING, ERROR
log_level = INFO
